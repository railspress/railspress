<% if @post.persisted? && @post.respond_to?(:versions_count) && @post.versions_count > 0 && !@post.auto_draft_status? %>
  <div class="sidebar-section pb-6 border-b border-gray-100 dark:border-gray-800" data-controller="collapsible" data-collapsible-open-value="false" data-collapsible-section-type-value="versions" data-collapsible-user-id-value="<%= current_user.id %>" data-section-type="versions">
    <div class="flex items-center gap-2 mb-4">
      <div class="drag-handle cursor-grab active:cursor-grabbing p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <button type="button" 
              data-action="click->collapsible#toggle" 
              class="flex-1 text-left text-sm font-medium text-gray-900 dark:text-white hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
        Versions (<%= @post.versions_count %>)
      </button>
      <button type="button" 
              data-action="click->collapsible#toggle" 
              class="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
        <svg class="w-4 h-4 transition-transform" data-collapsible-target="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
        </svg>
      </button>
    </div>
    
    <div data-collapsible-target="content">
      <div class="space-y-3 max-h-64 overflow-y-auto">
        <% @post.versions.limit(10).each_with_index do |version, index| %>
          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <div class="text-xs text-gray-600 dark:text-gray-400">
                <%= version.created_at.strftime('%b %d, %H:%M') %>
              </div>
              <% if index == 0 %>
                <span class="text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-1 rounded-full">Current</span>
              <% else %>
                <span class="text-xs bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded-full">v<%= @post.versions_count - index %></span>
              <% end %>
            </div>
            <div class="text-xs text-gray-700 dark:text-gray-300 mb-2">
              <%= @post.version_summary(version) %>
            </div>
            <% if index > 0 %>
              <%= button_to restore_version_admin_post_path(@post, version_id: version.id), 
                  method: :post,
                  data: { 
                    confirm: 'Restore this version?',
                    turbo_confirm: 'Restore this version?'
                  },
                  class: "w-full px-3 py-1.5 text-xs bg-indigo-600 hover:bg-indigo-700 text-white rounded transition-colors" do %>
                Restore
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
