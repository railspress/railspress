<%
  editor_type = local_assigns.fetch(:editor_type, 'editorjs')
  raw_content = local_assigns.fetch(:content, '')
  # Force content to be a plain string, not SafeBuffer, so we can escape it properly
  content = raw_content.to_str rescue raw_content.to_s
  field_name = local_assigns.fetch(:field_name, :content)
  placeholder = local_assigns.fetch(:placeholder, 'Start writing...')
  form = local_assigns.fetch(:form, nil)
%>

<div class="content-editor-wrapper" data-controller="content-editor" data-editor-type="<%= editor_type %>" data-autosave-target="content">
  <% if editor_type == 'editorjs' %>
    <%= render 'shared/editors/editorjs', 
        content: content, 
        placeholder: placeholder, 
        field_name: field_name, 
        form: form %>
  <% elsif editor_type == 'trix' %>
    <%= render 'shared/editors/trix', 
        content: content, 
        placeholder: placeholder, 
        field_name: field_name, 
        form: form %>
  <% elsif editor_type == 'ckeditor5' %>
    <%= render 'shared/editors/ckeditor5', 
        content: content, 
        placeholder: placeholder, 
        field_name: field_name, 
        form: form %>
  <% else %>
    <!-- Fallback: Simple Textarea -->
    <div class="simple-editor h-full">
      <% if form %>
        <%= form.text_area field_name,
            rows: 30,
            placeholder: placeholder,
            class: "w-full h-full min-h-[calc(100vh-300px)] bg-transparent border-none outline-none focus:ring-0 text-lg leading-relaxed resize-none text-gray-900 dark:text-gray-100",
            value: content %>
      <% end %>
    </div>
  <% end %>
</div>

<div class="editor-info flex items-center mt-2 text-xs text-gray-500">
  <span data-controller="editor-switcher" data-editor-switcher-current-value="<%= editor_type %>">
    <strong class="text-gray-400 cursor-pointer hover:text-gray-300 transition-colors" data-action="click->editor-switcher#toggle"><%= editor_type.titleize %></strong>
  </span>
  
  
</div>